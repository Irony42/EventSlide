<!DOCTYPE html>
<html>

<head>
  <title>Eventslide diaporama</title>
  <style>
    body {
      background-color: #353740;
    }

    #slideshow {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: contain;
      background-size: contain;
      background-repeat: no-repeat;
      background-position: center;
    }
  </style>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script>
    const partyname = new URLSearchParams(window.location.search).get('partyname');
    const storageKey = `EventSlide_${partyname}_currentIndex`;
    var images = [];
    var intervalImageChanger;
    var currentImageIndex = sessionStorage.getItem(storageKey) || 0;

    function changeImage() {

      function nextImage() {
        var imageUrl;
        if (currentImageIndex < images.length) {
          var currentImage = images[currentImageIndex];
          imageUrl = `/admin/getpic/${currentImage.fileName}`;
          
          currentImageIndex++;
          sessionStorage.setItem(storageKey, currentImageIndex);
        } else {
          imageUrl = '/default.jpg';
        }
        $('#slideshow').css('background-image', `url("${imageUrl}")`);
      }

      intervalImageChanger && clearInterval(intervalImageChanger);
      intervalImageChanger = setInterval(nextImage, 5000);
      $('#slideshow').click(nextImage);
    }

    function updateImageList() {
      $.getJSON(`/admin/getpics?acceptedonly=true`, function (data) {
        images = data.pictures;
        changeImage();
      });
    }

    updateImageList();
    setInterval(updateImageList, 15000);
  </script>
</head>

<body>
  <div id="slideshow"></div>
</body>

</html>